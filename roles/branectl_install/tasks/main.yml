--- 
- name: Check if branectl works
  command: branectl --help
  register: branectl_result
  ignore_errors: true

- name: Copy branectl from playbook dir
  ansible.builtin.copy:
    src: "{{ playbook_dir }}/branectl-build/branectl"
    dest: "/usr/local/bin/"
  when: branectl_result is failed

- name: Make the executable runnable
  file:
    path: /usr/local/bin/branectl
    mode: '0755'
  when: branectl_result is failed

- name: Check if branectl works again
  command: branectl --help

- name: ensure all services are stoped if they were running before (error is fine)
  command: branectl stop
  ignore_errors: true
  when: branectl_result is not failed